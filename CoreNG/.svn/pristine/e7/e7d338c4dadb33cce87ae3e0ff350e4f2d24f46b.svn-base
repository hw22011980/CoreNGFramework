<div class="row pt-5">
  <div class="col-2 pr-5 ml-4">
    <app-search (myEvent)="onGetDevices(true, $event)" [searchFields]="searchModel"></app-search>
  </div>
  <div class="col-9 pl-4 text-center">
    <div class="row">
      <div class="col-10 input-group">
        <button type="button" class="mr-2 btn btn-outline-primary" data-toggle="modal" data-target="#createDeviceModal">
          Create Device
        </button>         
        <div class="custom-file">
          <form #form>
            <input [(disabled)]="onGoingUpload" type="file" accept=".tsv" class="custom-file-input" id="inputTSVFile"
              (change)="onSelectFile($event)">
            <label class="custom-file-label" for="inputTSVFile">
              <div #label *ngIf="fileSelected"> {{fileSelected.name}} </div>
            </label>
          </form>
        </div>
        <div class="input-group-append">
          <button class="btn btn-outline-primary" type="button" (click)="onUploadTSV()"
            [(disabled)]="onGoingUpload">Upload
            TSV</button>
        </div>
      </div>
     

      <div class="col-1" align="right">
        <button class="btn btn-outline-primary" (click)="onGetDevices(true)">Refresh</button>
      </div>
      <app-spinner class="col-1" *ngIf="spinnerService.getloading(deviceService.getDevicesRequestUrl())">
      </app-spinner>
    </div>
    <hr>
    <div *ngIf="!spinnerService.getloading(deviceService.getDevicesRequestUrl())">
      <div *ngIf="!devices?.length; else showTable">
        <h3>No devices found </h3>
        <hr>
      </div>
    </div>

    <ng-template #showTable>
      <table class="table table-striped table-hover shadow p-3 mb-5 bg-white rounded">
        <thead>
          <tr>
            <th>PLANT NUMBER</th>
            <th>SERIAL NUMBER</th>
            <th>DEVICE TYPE</th>
            <th>DATE CREATED</th>
            <th>IP ADDRESS</th>
            <th>PORT</th>
            <th>STATUS</th>
          </tr>
        </thead>
        <tr *ngFor="let device of pagedItems" [routerLink]="['/devices' ,  device.deviceId ]">
          <td>{{ device.plantNumber}}</td>
          <td>{{ device.serialNumber}}</td>
          <td>{{ device.deviceType.deviceTypeName }}</td>
          <td>{{ device.createDate }}</td>
          <td *ngIf="device.deviceComms.suppLayer === 'TCP'; else other_content">{{device.deviceComms.ipAddress}}</td>
          <ng-template #other_content><td></td></ng-template>
          <td>{{ device.deviceComms.port }}</td>
          <td>
            <span class="badge status-padding"
              [ngClass]="{'badge-secondary': device.deviceStatus.description ==='Awaiting Installation',  'badge-info': device.deviceStatus.description ==='Installed', 'badge-success': device.deviceStatus.description ==='Commissioned'}">
              {{device.deviceStatus.description }}
            </span>
          </td>
        </tr>
      </table>
      <nav>
        <ul class="
            pagination justify-content-center" *ngIf="pager.pages && pager.pages.length">
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
            <a class="page-link" (click)="setPage(1)">First</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
            <a class="page-link" (click)="setPage(pager.currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of pager.pages" [ngClass]="{active:pager.currentPage === page}">
            <a class="page-link" style="width: 65px" (click)="setPage(page)">{{page}}</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
            <a class="page-link" (click)="setPage(pager.currentPage + 1)">Next</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
            <a class="page-link" (click)="setPage(pager.totalPages)">Last</a>
          </li>
        </ul>
      </nav>
    </ng-template>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="createDeviceModal" aria-labelledby="exampleModalLabel"
  aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create Device</h5>
      </div>
      <div class="modal-body">
        <app-device-create (myEvent)="onCreateDevice($event)"></app-device-create>
      </div>
    </div>
  </div>
</div>
