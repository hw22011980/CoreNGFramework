<div class="row pt-5">
  <div class="col-2 pr-5 ml-4">
    <app-search (myEvent)="onGetDLMSAssociations(true, $event)" [searchFields]="searchModel"></app-search>
  </div>
  <div class="col-9 pl-4 text-center w-75">
    <div class="row">
      <div class="col-10 input-group">
        <div class="input-group-prepend">
          <select name="keyDeviceType" class="custom-select" id="keyDeviceType" [(ngModel)]="selectedMeterType">
            <option *ngFor="let searchFilter of getDeviceTypes() | keyvalue" ngValue="{{searchFilter.key}}">
              {{searchFilter.key}}</option>
          </select>
        </div>
        <div class="custom-file">
          <form #form>
            <input [(disabled)]="onGoingUpload" type="file" accept=".dsfx, .dsf" class="custom-file-input"
              id="inputDSFFile" (change)="onSelectFile($event)">
            <label class="custom-file-label" for="inputDSFFile">
              <div *ngIf="fileSelected">{{ fileSelected.name }} </div>
            </label>
          </form>
        </div>
        <div class="input-group-append">
          <button [(disabled)]="onGoingUpload" class=" btn btn-outline-primary" type="button"
            (click)="onUploadDSF()">Upload
            DSF</button>
        </div>
      </div>
      <div class="col-1" align="right">
        <button class="btn btn-outline-primary" (click)="onGetDLMSAssociations(true)">Refresh</button>
      </div>
      <app-spinner class="col-1" *ngIf="spinnerService.getloading(keysService.getKeysRequestUrl())"></app-spinner>
    </div>
    <hr>

    <div class="top-buffer"></div>
    <div *ngIf="!spinnerService.getloading(keysService.getKeysRequestUrl())">
      <div *ngIf="!dlmsAssociations?.length; else showTable">
        <h3>No DLMS Associations found </h3>
        <hr>
      </div>
    </div>

    <ng-template #showTable>
      <div class="header text-left">
        KEYS (DLMS ASSOCIATIONS)
      </div>
      <br>
      <table class="table table-striped table-hover shadow p-3 mb-5 bg-white rounded">
        <thead>
          <tr>
            <th>ID</th>
            <th>DESCRIPTION</th>
            <th>CLIENT ID</th>
            <th>APPLICATION CONTEXT</th>
            <th>AUTHENTICATION METHOD</th>
            <th>PRE-ESTABLISHED</th>
            <th>DEVICE TYPE</th>
            <th>STATUS</th>
          </tr>
        </thead>
        <tr *ngFor="let dlmsAssociation of pagedItems" [routerLink]="['/keys' , dlmsAssociation.id ]">
          <td>{{ dlmsAssociation.id }}</td>
          <td>{{ dlmsAssociation.description }}</td>
          <td>{{ dlmsAssociation.clientId }}</td>
          <td>{{ dlmsAssociation.applicationContext_Description }}</td>
          <td>{{ dlmsAssociation.authenticationMethod_Description }}</td>
          <td><span class="badge status-padding"
              [ngClass]="{'badge-danger': dlmsAssociation.preEstablished === false, 'badge-success': dlmsAssociation.preEstablished === true}">
              {{ dlmsAssociation.preEstablished ? "True" :"False" }}
            </span>
          </td>
          <td>{{ dlmsAssociation.deviceTypeName == "0" ? "Not Provided" :  dlmsAssociation.deviceTypeName}}</td>
          <td>
            <span class="badge status-padding"
              [ngClass]="{'badge-danger': dlmsAssociation.inActive === false, 'badge-success': dlmsAssociation.inActive === true}">
              {{ dlmsAssociation.inActive ? "Active" :"Inactive"  }}
            </span>
          </td>
        </tr>
      </table>
      <nav>
        <ul class="
              pagination justify-content-center" *ngIf="pager.pages && pager.pages.length">
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
            <a class="page-link" (click)="setPage(1)">First</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
            <a class="page-link" (click)="setPage(pager.currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of pager.pages" [ngClass]="{active:pager.currentPage === page}">
            <a class="page-link" style="width: 45px" (click)="setPage(page)">{{page}}</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
            <a class="page-link" (click)="setPage(pager.currentPage + 1)">Next</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
            <a class="page-link" (click)="setPage(pager.totalPages)">Last</a>
          </li>
        </ul>
      </nav>
    </ng-template>
  </div>
</div>