import { Component, OnInit } from '@angular/core';
import { ActionResponse } from './shared/action-response.model';
import { ActivatedRoute, Router } from '@angular/router';
import { ActionResponseService } from './action-response.service';

@Component({
  selector: 'app-action-response',
  templateUrl: './action-response.component.html',
  styleUrls: ['./action-response.component.css']
})
export class ActionResponseComponent implements OnInit {
  actionResponse: ActionResponse;
  actionResponseId: string;
  public headers = [] as string[];
  public headers2 = [] as string[];
  action: string;
  constructor(private activatedRoute: ActivatedRoute, private actionResponseService: ActionResponseService, private router: Router) { }

  ngOnInit() {

    this.actionResponseId = this.activatedRoute.snapshot.params['id'];
    this.activatedRoute.firstChild.params.subscribe(
      (params: any) => {
        if (params.hasOwnProperty('id') !== '') {
          this.actionResponseId = (params.id);
        }
      });

    this.actionResponse = this.actionResponseService.get(this.actionResponseId);

    if (this.actionResponse == null) {
      this.router.navigate(['/devices']);
    } else {
      this.processHeaders();
    }


  }

  processHeaders() {
    this.action = this.actionResponse.actionResponse.action;

    if (this.action === 'DeviceImport') {
      this.headers.push('Device Plant Number');
      this.headers.push('Status');
      this.headers.push('Error Response');
    } else if (this.action === 'SetDeviceDLMSKeys') {
      this.headers.push('Device Serial Number');
      this.headers.push('Status');
      this.headers.push('Error Response');
    }

    this.action = this.action.replace(/([A-Z]+)/g, ' $1').replace(/([A-Z][a-z])/g, ' $1');
    this.action = this.action.charAt(0).toUpperCase() + this.action.slice(1);
  }

}
