import { DeviceConnectStatus } from './device-connect-status';
import { HttpParams } from '@angular/common/http';
import { Device } from './device.model';
import { DeviceService } from '../device.service';

export class DeviceCommActions {
    devicePayload: Device; 
    constructor(private deviceService: DeviceService) {   
    }

    autoDisconnectLastConnection()
    {
  
      if(localStorage.hasOwnProperty('previousId'))
      {
        let connectstatus: DeviceConnectStatus = JSON.parse(localStorage.getItem('previousId'));
        
        if(connectstatus.isConnected)
        {
          let params = new HttpParams;
          params = params.append('plantNumber', connectstatus.plantNumber);
          this.deviceService.setDevices(true, params, 'disconnect').subscribe((StandardResponse) => {
          this.devicePayload = StandardResponse.data;
          if(StandardResponse.success){ 
              connectstatus.isConnected = false;
              localStorage.setItem('previousId', JSON.stringify(connectstatus));    
              console.log(JSON.stringify(connectstatus));
          }
          },(error: any) => {
            console.log(error);            
          });
        }
      }
  
    }

  }