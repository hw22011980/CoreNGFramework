<form [formGroup]="updateForm" (ngSubmit)="onUpdateElements()">
  <div class="card-header">
    <div class="row">
      <div class="col-9">{{informationFields.Header}}</div>
      <div class="col-3">
        <div class="row">
          <div class="col-7" *ngIf="informationFields.Editable">
            <button *ngIf="edit" type="button" type="submit" class="btn btn-success btn-sm ml-5" id="apply"
              [disabled]="updateForm.invalid || updateForm.pristine">Apply</button>
          </div>
          <div class="col-5" *ngIf="informationFields.Editable">
            <button *ngIf="edit" type="button" class="btn btn-danger btn-sm"
              (click)="edit=false; editableElementsToReadOnly(); resetFiles();" data-toggle="tooltip">Cancel</button>
            <button *ngIf="!edit" type="button" class="btn btn-light btn-sm"
              (click)="edit=true; enableEditableElements();" data-toggle="tooltip">Edit ... </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf='informationFields.InformationFields != null'>
    <div class="card-body">

      <div class="float-right meter-image" *ngIf="informationFields.Image"><img [src]="informationFields.ImageSrc"
          (error)="img.src = './assets/images/meters/generic_meter.png'" width="180" height="255" alt="meter image"
          #img>
      </div>

      <div formArrayName="textUpdate"
        *ngFor="let textInformation of informationTextDictionary | keyvalue : KeepOrder; let i = index">
        <div class="mb-3">
          <div class="input-group input-group-sm">
            <div class="input-group-prepend">
              <span class="input-group-text justify-content-end"
                id="inputGroup-sizing-sm">{{textInformation.value.Description}}</span>
            </div>
            <input maxlength="{{textInformation.value.MaxLength}}" [formControlName]="i" type="text"
              class="form-control" value="{{textInformation.value.Value}}"
              (keypress)="omit_invalid_characters($event, informationTextDictionary, i)">
          </div>
          <!--Error Messages-->
          <div class="input-group input-group-sm"
            *ngIf="updateForm.controls['textUpdate'].controls[i].invalid && !updateForm.controls['textUpdate'].controls[i].pristine">
            <div class="input-group-prepend"></div>
            <small class="small-error">{{getErrorMessage(updateForm.controls['textUpdate'].controls[i].value,informationTextDictionary, i)}}</small>
          </div>
        </div>
      </div>
      <div formArrayName="dropDownUpdate"
        *ngFor="let dropDownInformation of informationDropDownDictionary | keyvalue : KeepOrder; let i = index">
        <div class="input-group input-group-sm mb-3">
          <div class="input-group-prepend">
            <label class="input-group-text justify-content-end"
              id="inputGroup-sizing-sm">{{dropDownInformation.value.Description}}</label>
          </div>
          <select [formControlName]="i" #dd class="custom-select" (change)="onDDSelect(dropDownInformation, dd.value)">
            <option *ngFor="let meterType of dropDownInformation.value.OptionValues | keyvalue  :KeepOrder"
              ngValue="{{meterType.value}}">
              {{meterType.key}}</option>
          </select>
        </div>
      </div>
      <div formArrayName="dateTimeUpdate"
        *ngFor="let dateTimeInformation of informationDateTimeDictionary | keyvalue : KeepOrder; let i = index">
        <div class="mb-3">
          <div class="input-group input-group-sm">
            <div class="input-group-prepend">
              <span class="input-group-text justify-content-end"
                id="inputGroup-sizing-sm">{{dateTimeInformation.value.Description}}</span>
            </div>
            <input step="1" class="form-control" type="datetime-local" [formControlName]="i"
              value="{{dateTimeInformation.value.Value}}">
          </div>
        </div>
      </div>
      <div formArrayName="fileUpdate" *ngFor="let fileInformation of getFileElements() | keyvalue; let i = index">
        <div class="mb-3">
          <div class="input-group input-group-sm" *ngIf=getEditInputVisibility(fileInformation.value.Editable)>
            <div class="input-group-prepend">
              <span class="input-group-text justify-content-end"
                id="inputGroup-sizing-sm">{{fileInformation.value.Description}}</span>
            </div>
            <div class="custom-file">
              <input [formControlName]="i" #fileInput type="file" accept="{{fileInformation.value.FileExtension}}"
                class="custom-file-input" (change)="onSelectFile($event)">
              <label class="custom-file-label" for="fw-image-file">
                <span *ngIf="fileSelected">{{fileSelected.name}}</span>
              </label>
            </div>
          </div>
          <div class="input-group input-group-sm"
            *ngIf="updateForm.controls['fileUpdate'].controls[i].invalid && !updateForm.controls['fileUpdate'].controls[i].pristine ">
            <div class="input-group-prepend"></div>
            <small class="small-error">{{fileInformation.value.Description}} must be a {{fileInformation.value.FileExtension}} file</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
