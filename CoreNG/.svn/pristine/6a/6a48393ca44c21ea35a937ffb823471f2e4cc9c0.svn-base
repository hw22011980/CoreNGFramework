<div class="row pt-5">
  <div class="col-2 pr-5 ml-4">
    <app-search (myEvent)="onGetFirmwares(true,$event)" [searchFields]="searchModel"></app-search>
  </div>
  <div class="col-9 pl-4 text-center">
    <div class="row">
      <div class="col-10 input-group">
        <div class="custom-file">
          <form #form>
            <input #fileInput [(disabled)]="onGoingUpload" type="file" accept=".bin" class="custom-file-input"
              id="inputFirmwareFile" (change)="openModal($event)" (click)="fileInput.value = null">
            <label class="custom-file-label" for="inputFirmwareFile">
              <div *ngIf="fileSelected">{{ fileSelected.name }} </div>
            </label>
          </form>

        </div>
        <div class="input-group-append">
          <button class="btn btn-outline-primary" type="button" data-toggle="modal" data-target="#firmwareUploadModal"
            [(disabled)]="onGoingUpload" id="uploadFirmwareModal" (click)="clearInputValues()">Upload
            Firmware</button>
        </div>
      </div>
      <div class="col-1" align="right">
        <button class="btn btn-outline-primary" (click)="onGetFirmwares(true)">Refresh</button>
      </div>
      <app-spinner class="col-1" *ngIf="spinnerService.getloading(firmwareService.getFirmwareRequestUrl())">
      </app-spinner>
    </div>

    <hr>
    <div *ngIf="!spinnerService.getloading(firmwareService.getFirmwareRequestUrl())">
      <div *ngIf="!firmwares?.length; else showTable">
        <h3>No firmwares found </h3>
        <hr>
      </div>
    </div>
    <ng-template #showTable>
      <table class="table table-striped table-hover shadow p-3 mb-5 bg-white rounded">
        <thead>
          <tr>
            <th>ID</th>
            <th>FIRMWARE CODE</th>
            <th>NAME</th>
            <th>VERSION</th>
            <th>DESCRIPTION</th>
            <th>DEVICE TYPE</th>
            <th>STATUS</th>
          </tr>
        </thead>
        <tr *ngFor="let firmware of pagedItems" [routerLink]="['/firmwares' , firmware.id ]">
          <td>{{ firmware.id }}</td>
          <td>{{ firmware.fwCode}}</td>
          <td>{{ firmware.fwName }}</td>
          <td>{{ firmware.fwVersion }}</td>
          <td>{{ firmware.fwDescription }}</td>
          <td>{{ firmware.deviceTypeName }}</td>
          <td>
            <span class="badge status-padding"
              [ngClass]="{'badge-success': firmware.status == 1, 'badge-danger': firmware.status == 0}">
              {{ firmware.statusDescription }}
            </span>
          </td>
        </tr>
      </table>
      <nav>
        <ul class="
              pagination justify-content-center" *ngIf="pager.pages && pager.pages.length">
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
            <a class="page-link" (click)="setPage(1)">First</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
            <a class="page-link" (click)="setPage(pager.currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of pager.pages" [ngClass]="{active:pager.currentPage === page}">
            <a class="page-link" style="width: 45px" (click)="setPage(page)">{{page}}</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
            <a class="page-link" (click)="setPage(pager.currentPage + 1)">Next</a>
          </li>
          <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
            <a class="page-link" (click)="setPage(pager.totalPages)">Last</a>
          </li>
        </ul>
      </nav>
    </ng-template>
  </div>
</div>
<!-- Firmware Upload Modal -->
<div class="modal fade" id="firmwareUploadModal" tabindex="-1" role="dialog" aria-labelledby="firmwareUploadModal"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="firmwareUploadModal">Upload Firmware</h5>
        <button #myClose type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid text-left">
          <form #uploadForm="ngForm" (ngSubmit)="onUploadFirmware()">
            <div class="form-group row">
              <label for="fwcode" class="col-sm-4 required-field">Firmware Code</label>
              <div class="col-sm-8">
                <input maxlength="20" name="fwcode" type="text" class="form-control" id="fw-code" required
                  appWhiteSpaceValidator ngModel #fwcode="ngModel"
                  [pattern]="getTextPatternValidator(false)"
                  (keypress)="omit_invalid_characters($event, false)">
                <small *ngIf="fwcode.invalid && fwcode.dirty" [innerHTML]="getErrorMessage(fwcode.value, 'Firmware Code', true)"></small>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwname" class="col-sm-4 required-field">Firmware Name</label>
              <div class="col-sm-8">
                <input maxlength="50" name="fwname" ngModel type="text" class="form-control" id="fwname" required
                  appWhiteSpaceValidator #fwname="ngModel"
                  [pattern]="getTextPatternValidator(false)"
                  (keypress)="omit_invalid_characters($event, false)">
                <small *ngIf="fwname.invalid && fwname.dirty" [innerHTML]="getErrorMessage(fwname.value, 'Firmware Name', true)"></small>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwversion" class="col-sm-4 required-field">Firmware Version</label>
              <div class="col-sm-8">
                <input maxlength="16" name="fwversion" ngModel type="text" class="form-control" id="fwversion" required
                  appWhiteSpaceValidator #fwversion="ngModel"
                  [pattern]="getTextPatternValidator(false)"
                  (keypress)="omit_invalid_characters($event, false)">
                  <small *ngIf="fwversion.invalid && fwversion.dirty" [innerHTML]="getErrorMessage(fwversion.value, 'Firmware Version', true)"></small>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwedition" class="col-sm-4 required-field">Firmware Edition</label>
              <div class="col-sm-8">
                <input maxlength="50" name="fwedition" ngModel type="text" class="form-control" id="fwedition" required
                  appWhiteSpaceValidator #fwedition="ngModel"
                  [pattern]="getTextPatternValidator(false)"
                  (keypress)="omit_invalid_characters($event, false)">
                  <small *ngIf="fwedition.invalid && fwedition.dirty" [innerHTML]="getErrorMessage(fwedition.value, 'Firmware Edition', true)"></small>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwdeviceType" class="col-sm-4 required-field">Device Type</label>
              <div class="col-sm-8">
                <select name="fwdevicetype" class="custom-select" id="fwdeviceType" [(ngModel)]="defaultMeterType">
                  <option *ngFor="let meterType of meterTypeDictionary | keyvalue" ngValue="{{meterType.value}}">
                    {{meterType.key}}</option>
                </select>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwdescription" class="col-sm-4">&nbsp; Description</label>
              <div class="col-sm-8">
                <input maxlength="1024" name="fwdescription" ngModel type="text" class="form-control"
                  id="fw-description" #fwdescription="ngModel"
                  [pattern]="getTextPatternValidator(false, '^[a-zA-Z0-9-_#. ]*$')"
                  (keypress)="omit_invalid_characters($event, false, '^[a-zA-Z0-9-_#. ]*$')">
                  <small *ngIf="fwdescription.invalid && fwdescription.dirty" [innerHTML]="getErrorMessage(fwdescription.value, 'Firmware Desription', false, '^[a-zA-Z0-9-_#. ]*$', 'A-Z a-z 0-9 - _ # . space')"></small>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwstatus" class="col-sm-4 required-field">Firmware Status</label>
              <div class="col-sm-8">
                <select name="fwstatus" class="custom-select" id="fwstatus" [(ngModel)]="defaultStatus">
                  <option *ngFor="let firmwareStatus of firmwareStatusDictionary | keyvalue"
                    ngValue="{{firmwareStatus.value}}">
                    {{firmwareStatus.key}}</option>
                </select>
              </div>
            </div>
            <div class="form-group row">
              <label for="fwimage" class="col-sm-4 required-field">Firmware Image</label>
              <div class="col-sm-8">
                <div class="row">
                  <input title={{fileSelected?.name}} name="fwimagefile" ngModel #fwimagefile="ngModel" type="file"
                    accept=".bin" class="custom-file-input col-sm-9" id="fwimagefile" (change)="onSelectFile($event)"
                    (click)="fwimagefile.value = null" appFileExtensionValidator>
                  <label class="custom-file-label inputfilemargin" for="fwimagefile">
                    <span *ngIf="fileSelected">{{fileSelected.name}}</span>
                  </label>
                  <small class="inputfilemargin"
                    *ngIf="fwimagefile.hasError('invalidFile') && fwimagefile.dirty">Firmware
                    Image must be a .bin
                    file</small>
                  <small class="inputfilemargin" *ngIf="!fileSelected && fwimagefile.dirty">Firmware
                    Image is required</small>
                </div>
              </div>
            </div>
            <button type="button" class="btn btn-primary w-100" type="submit" (click)="onCloseModal($event)"
              [disabled]="!activateUploadButton()" id="uploadFirmwareButtonModal">Upload
              Firmware</button>
          </form>
        </div>
      </div>
      <!--
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" type="submit">Upload Firmware</button>
      </div>
      -->
    </div>
  </div>
</div>